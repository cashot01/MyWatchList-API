<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>MyWatchlist</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>

<div class="container">

    <h1>ðŸŽ¬ MyWatchlist</h1>

    <!-- DASHBOARD -->
    <div class="dashboard">
        <div class="card">Total<br><strong th:text="${total}"></strong></div>
        <div class="card">Assistidos<br><strong th:text="${assistidos}"></strong></div>
        <div class="card">Watchlist<br><strong th:text="${watchlist}"></strong></div>
    </div>

    <!-- FILTROS -->
    <div class="filtros">
        <a th:href="@{/filmes}">Todos</a>
        <a th:href="@{/filmes(filtro='assistidos')}">Assistidos</a>
        <a th:href="@{/filmes(filtro='watchlist')}">Watchlist</a>
        <a class="novo" th:href="@{/filmes/novo}">+ Novo</a>

        <!-- BotÃ£o de Logout -->
        <a th:href="@{/logout}" class="logout-btn" onclick="return confirm('Deseja sair?');">
            <i class="fas fa-sign-out-alt"></i> Sair
        </a>
    </div>

    <!-- MENSAGEM DE FEEDBACK -->
    <div th:if="${mensagem}" class="alert" th:classappend="${sucesso} ? 'alert-success' : 'alert-danger'">
        <i th:classappend="${sucesso} ? 'fas fa-check-circle' : 'fas fa-exclamation-circle'"></i>
        <span th:text="${mensagem}"></span>
    </div>

    <!-- TABELA DE FILMES -->
    <div class="card p-3">
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>TÃ­tulo</th>
                    <th>Tipo</th>
                    <th>GÃªnero</th>
                    <th>Nota</th>
                    <th>Review</th>
                    <th>Status</th>
                    <th>AÃ§Ãµes</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="filme : ${filmes}">
                    <td data-label="ID" th:text="${filme.id}"></td>
                    <td data-label="TÃ­tulo" th:text="${filme.titulo}"></td>
                    <td data-label="Tipo">
                            <span class="badge" th:classappend="${filme.tipo == 'FILME'} ? 'badge-filme' : 'badge-serie'"
                                  th:text="${filme.tipo}"></span>
                    </td>
                    <td data-label="GÃªnero">
                        <span class="genero-badge" th:text="${filme.genero}"></span>
                    </td>
                    <td data-label="Nota">
                        <div class="nota-container">
                            <span class="estrelas">â˜…</span>
                            <span class="nota-valor" th:text="${filme.nota}"></span>
                        </div>
                    </td>
                    <td data-label="Review" th:text="${filme.review}"></td>
                    <td data-label="Status">
                            <span class="badge" th:classappend="${filme.status == 'ASSISTIDO'} ? 'badge-assistido' : 'badge-watchlist'"
                                  th:text="${filme.status}"></span>
                    </td>
                    <td data-label="AÃ§Ãµes">
                        <a th:href="@{/filmes/editar/{id}(id=${filme.id})}" class="btn btn-warning btn-sm">
                            <i class="fas fa-edit"></i> Editar
                        </a>
                        <a th:href="@{/filmes/deletar/{id}(id=${filme.id})}" class="btn btn-danger btn-sm"
                           onclick="return confirm('Tem certeza que deseja excluir este filme?');">
                            <i class="fas fa-trash-alt"></i> Excluir
                        </a>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- PAGINAÃ‡ÃƒO -->
    <nav aria-label="PaginaÃ§Ã£o" th:if="${totalPages > 1}">
        <ul class="pagination justify-content-center">
            <!-- BotÃ£o Primeira PÃ¡gina -->
            <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
                <a class="page-link" th:href="@{/filmes(filtro=${filtro}, page=0, size=${pageSize})}">
                    <i class="fas fa-angle-double-left"></i> Primeira
                </a>
            </li>

            <!-- BotÃ£o Anterior -->
            <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
                <a class="page-link" th:href="@{/filmes(filtro=${filtro}, page=${currentPage - 1}, size=${pageSize})}">
                    <i class="fas fa-chevron-left"></i> Anterior
                </a>
            </li>

            <!-- NÃºmeros de PÃ¡gina (com lÃ³gica inteligente) -->
            <li class="page-item" th:if="${currentPage > 2}" th:classappend="${currentPage == 0} ? 'active'">
                <a class="page-link" th:href="@{/filmes(filtro=${filtro}, page=0, size=${pageSize})}">1</a>
            </li>

            <li class="page-item disabled" th:if="${currentPage > 3}">
                <span class="page-link">...</span>
            </li>

            <li class="page-item" th:each="i : ${#numbers.sequence(currentPage > 1 ? currentPage - 1 : 0,
                                                                     currentPage < totalPages - 2 ? currentPage + 1 : totalPages - 1)}"
                th:classappend="${i == currentPage} ? 'active'">
                <a class="page-link" th:href="@{/filmes(filtro=${filtro}, page=${i}, size=${pageSize})}"
                   th:text="${i + 1}"></a>
            </li>

            <li class="page-item disabled" th:if="${currentPage < totalPages - 3}">
                <span class="page-link">...</span>
            </li>

            <li class="page-item" th:if="${currentPage < totalPages - 3}"
                th:classappend="${currentPage == totalPages - 1} ? 'active'">
                <a class="page-link" th:href="@{/filmes(filtro=${filtro}, page=${totalPages - 1}, size=${pageSize})}"
                   th:text="${totalPages}"></a>
            </li>

            <!-- BotÃ£o PrÃ³xima -->
            <li class="page-item" th:classappend="${currentPage == totalPages - 1} ? 'disabled'">
                <a class="page-link" th:href="@{/filmes(filtro=${filtro}, page=${currentPage + 1}, size=${pageSize})}">
                    PrÃ³xima <i class="fas fa-chevron-right"></i>
                </a>
            </li>

            <!-- BotÃ£o Ãšltima PÃ¡gina -->
            <li class="page-item" th:classappend="${currentPage == totalPages - 1} ? 'disabled'">
                <a class="page-link" th:href="@{/filmes(filtro=${filtro}, page=${totalPages - 1}, size=${pageSize})}">
                    Ãšltima <i class="fas fa-angle-double-right"></i>
                </a>
            </li>
        </ul>

        <!-- InformaÃ§Ã£o de PÃ¡gina -->
        <div class="text-center mt-3">
            <small th:text="'PÃ¡gina ' + (${currentPage} + 1) + ' de ' + ${totalPages} + ' | Total: ' + ${totalItems} + ' filmes'"></small>
        </div>
    </nav>

</div>

</body>
</html>