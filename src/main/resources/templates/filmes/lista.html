<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>MyWatchlist</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>

<div class="container">

    <h1>ðŸŽ¬ MyWatchlist</h1>

    <!-- DASHBOARD -->
    <div class="dashboard">
        <div class="card">Total<br><strong th:text="${total}"></strong></div>
        <div class="card">Assistidos<br><strong th:text="${assistidos}"></strong></div>
        <div class="card">Watchlist<br><strong th:text="${watchlist}"></strong></div>
    </div>

    <!-- FILTROS -->
    <div class="filtros">
        <a th:href="@{/filmes}">Todos</a>
        <a th:href="@{/filmes(filtro='assistidos')}">Assistidos</a>
        <a th:href="@{/filmes(filtro='watchlist')}">Watchlist</a>
        <a class="novo" th:href="@{/filmes/novo}">+ Novo</a>

        <!-- BotÃ£o de Logout -->
        <a th:href="@{/logout}" class="logout-btn" onclick="return confirm('Deseja sair?');">
            <i class="fas fa-sign-out-alt"></i> Sair
        </a>
    </div>

    <!-- MENSAGEM DE FEEDBACK -->
    <div th:if="${mensagem}" class="alert" th:classappend="${sucesso} ? 'alert-success' : 'alert-danger'">
        <i th:classappend="${sucesso} ? 'fas fa-check-circle' : 'fas fa-exclamation-circle'"></i>
        <span th:text="${mensagem}"></span>
    </div>

    <!-- TABELA DE FILMES -->
    <div class="card p-3">
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>TÃ­tulo</th>
                    <th>Tipo</th>
                    <th>GÃªnero</th>
                    <th>Nota</th>
                    <th>Review</th>
                    <th>Status</th>
                    <th>AÃ§Ãµes</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="filme : ${filmes}">
                    <td data-label="ID" th:text="${filme.id}"></td>
                    <td data-label="TÃ­tulo" th:text="${filme.titulo}"></td>
                    <td data-label="Tipo">
                            <span class="badge" th:classappend="${filme.tipo == 'FILME'} ? 'badge-filme' : 'badge-serie'"
                                  th:text="${filme.tipo}"></span>
                    </td>
                    <td data-label="GÃªnero">
                        <span class="genero-badge" th:text="${filme.genero}"></span>
                    </td>
                    <td data-label="Nota">
                        <div class="nota-container">
                            <span class="estrelas">â˜…</span>
                            <span class="nota-valor" th:text="${filme.nota}"></span>
                        </div>
                    </td>
                    <td data-label="Review" th:text="${filme.review}"></td>
                    <td data-label="Status">
                            <span class="badge" th:classappend="${filme.status == 'ASSISTIDO'} ? 'badge-assistido' : 'badge-watchlist'"
                                  th:text="${filme.status}"></span>
                    </td>
                    <td data-label="AÃ§Ãµes">
                        <a th:href="@{/filmes/editar/{id}(id=${filme.id})}" class="btn btn-warning btn-sm">
                            <i class="fas fa-edit"></i> Editar
                        </a>
                        <a th:href="@{/filmes/deletar/{id}(id=${filme.id})}" class="btn btn-danger btn-sm"
                           onclick="return confirm('Tem certeza que deseja excluir este filme?');">
                            <i class="fas fa-trash-alt"></i> Excluir
                        </a>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- PAGINAÃ‡ÃƒO CORRIGIDA -->
    <nav aria-label="PaginaÃ§Ã£o" th:if="${totalPages > 1}" class="pagination-container">
        <div class="pagination-info">
            <span th:text="'Mostrando ' + ${#lists.size(filmes)} + ' de ' + ${totalItems} + ' filmes'"></span>
        </div>

        <ul class="pagination">
            <!-- BotÃ£o Primeira -->
            <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
                <a class="page-link" th:href="@{/filmes(filtro=${filtro}, page=0, size=${pageSize})}"
                   th:if="${currentPage > 0}" aria-label="Primeira">
                    <span aria-hidden="true">&laquo;&laquo;</span>
                </a>
                <span class="page-link" th:if="${currentPage == 0}" aria-hidden="true">&laquo;&laquo;</span>
            </li>

            <!-- BotÃ£o Anterior -->
            <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
                <a class="page-link" th:href="@{/filmes(filtro=${filtro}, page=${currentPage - 1}, size=${pageSize})}"
                   th:if="${currentPage > 0}" aria-label="Anterior">
                    <span aria-hidden="true">&laquo;</span>
                </a>
                <span class="page-link" th:if="${currentPage == 0}" aria-hidden="true">&laquo;</span>
            </li>

            <!-- NÃšMEROS DE PÃGINA (SEM DUPLICAÃ‡ÃƒO) -->
            <li class="page-item" th:each="i : ${#numbers.sequence(
                totalPages <= 5 ? 0 : (currentPage <= 2 ? 0 : (currentPage >= totalPages - 3 ? totalPages - 5 : currentPage - 2)),
                totalPages <= 5 ? totalPages - 1 : (currentPage <= 2 ? 4 : (currentPage >= totalPages - 3 ? totalPages - 1 : currentPage + 2))
            )}"
                th:classappend="${i == currentPage} ? 'active'">
                <a class="page-link" th:href="@{/filmes(filtro=${filtro}, page=${i}, size=${pageSize})}"
                   th:text="${i + 1}"></a>
            </li>

            <!-- BotÃ£o PrÃ³xima -->
            <li class="page-item" th:classappend="${currentPage == totalPages - 1} ? 'disabled'">
                <a class="page-link" th:href="@{/filmes(filtro=${filtro}, page=${currentPage + 1}, size=${pageSize})}"
                   th:if="${currentPage < totalPages - 1}" aria-label="PrÃ³xima">
                    <span aria-hidden="true">&raquo;</span>
                </a>
                <span class="page-link" th:if="${currentPage == totalPages - 1}" aria-hidden="true">&raquo;</span>
            </li>

            <!-- BotÃ£o Ãšltima -->
            <li class="page-item" th:classappend="${currentPage == totalPages - 1} ? 'disabled'">
                <a class="page-link" th:href="@{/filmes(filtro=${filtro}, page=${totalPages - 1}, size=${pageSize})}"
                   th:if="${currentPage < totalPages - 1}" aria-label="Ãšltima">
                    <span aria-hidden="true">&raquo;&raquo;</span>
                </a>
                <span class="page-link" th:if="${currentPage == totalPages - 1}" aria-hidden="true">&raquo;&raquo;</span>
            </li>
        </ul>

        <div class="pagination-info">
            <span th:text="'PÃ¡gina ' + (${currentPage} + 1) + ' de ' + ${totalPages}"></span>
        </div>
    </nav>

</div>

</body>
</html>